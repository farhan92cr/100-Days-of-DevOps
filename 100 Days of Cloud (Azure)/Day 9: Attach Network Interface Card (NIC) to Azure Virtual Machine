Day 9: Attach Network Interface Card (NIC) to Azure Virtual Machine:

The Nautilus DevOps team is migrating services to Azure. They are breaking down tasks to ensure better control and optimization. You are tasked with attaching an existing network interface (NIC) to a virtual machine (VM).

An existing VM named xfusion-vm and a network interface named xfusion-nic already exist in the West US region.

Attach the network interface xfusion-nic to the VM xfusion-vm.
Ensure the NIC's status is attached before submitting the task.
Make sure that the virtual machine initialization has been completed before submitting this task.



Use below given Azure Credentials: (You can run the showcreds command on the azure-client host to retrieve credentials)

Portal URL	https://portal.azure.com
Username	kk_lab_user_main-1a7d044ea82a4fcd@azurefreekmlprod.onmicrosoft.com
Password	xT9k7Gbp
Start Time	Thu Dec 04 04:06:07 UTC 2025
End Time	Thu Dec 04 05:06:07 UTC 2025


SOLUTION:

Simple Explanation of Day 9 Lab
Today you're attaching an existing Network Interface Card (NIC) to an existing Virtual Machine. Think of this like plugging a network cable into your computer. You have:

A VM (xfusion-vm) - your "computer"

A NIC (xfusion-nic) - your "network cable/port"

Your task is to connect the NIC to the VM so it can communicate over the network. This is like adding a second network card to a physical server.

Step-by-Step Solution (Using Azure CLI)
Step 1: Login to Azure
bash
az login -u kk_lab_user_main-1a7d044ea82a4fcd@azurefreekmlprod.onmicrosoft.com -p xT9k7Gbp
Step 2: Check Existing Resources
bash
# Check if VM exists (West US region)
az vm list --query "[?name=='xfusion-vm'].{Name:name, ResourceGroup:resourceGroup, Location:location}" -o table

# Check if NIC exists
az network nic list --query "[?name=='xfusion-nic'].{Name:name, ResourceGroup:resourceGroup, Location:location}" -o table

# Check current VM network interfaces
az vm show --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-vm --query "networkProfile.networkInterfaces[].id"
Step 3: Attach the NIC to VM
bash
az vm nic add \
  --resource-group <YOUR_RESOURCE_GROUP> \
  --vm-name xfusion-vm \
  --nics xfusion-nic
Single line version:

bash
az vm nic add --resource-group <YOUR_RESOURCE_GROUP> --vm-name xfusion-vm --nics xfusion-nic
Step 4: Verify NIC Attachment
bash
# Check NIC is attached to VM
az vm show --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-vm --query "networkProfile.networkInterfaces[].id"

# Check NIC status
az network nic show --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-nic --query "{Name:name, VirtualMachine:id, ProvisioningState:provisioningState}"
Step 5: Check VM Status (IMPORTANT)
bash
# Verify VM initialization is complete
az vm get-instance-view --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-vm --query "instanceView.statuses[1].displayStatus" -o tsv

# If VM is not running, start it
az vm start --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-vm

# Wait a moment, then check again
sleep 30
az vm get-instance-view --resource-group <YOUR_RESOURCE_GROUP> --name xfusion-vm --query "instanceView.statuses[1].displayStatus" -o tsv
Step-by-Step Solution (Using Azure UI/Portal)
Step 1: Login to Azure Portal
Go to https://portal.azure.com

Use credentials provided

Step 2: Navigate to the VM
Search for xfusion-vm in the search bar

Click on the VM (make sure it's in West US)

Step 3: Attach Network Interface
In the VM menu, click "Networking" (under Settings)

Click "Attach network interface" at the top

In the dropdown, select xfusion-nic

Click "OK"

Step 4: Save Changes
The change will be applied immediately

You'll see a notification: "Updating network interfaces..."

Wait for success notification: "Successfully updated network interfaces"

Step 5: Verify Attachment
Go back to VM's "Networking" page

You should see both network interfaces listed

xfusion-nic should be one of them

Check VM status is "Running" at the top

Key Terms Explained
Network Interface Card (NIC): A virtual network adapter that connects a VM to a virtual network.

Primary vs Secondary NIC:

Every VM has at least one primary NIC

You're adding a secondary NIC

Multiple NICs Use Cases: Different subnets, network isolation, traffic separation.

VM Initialization: The VM must be fully started and running for the NIC to be operational.

Benefits and Use Cases
Why add multiple NICs to a VM?

Network Isolation: Separate management traffic from data traffic

Multi-tier Applications: Connect to frontend and backend subnets simultaneously

Network Appliances: Firewalls, load balancers, gateways need multiple interfaces

Traffic Separation: Separate backup traffic from production traffic

High Availability: Connect to multiple networks for redundancy

Use Cases:

Firewall VMs with internal/external interfaces

Application servers connecting to web and database subnets

Backup servers with isolated backup network

Network monitoring appliances

Important Notes
Region Important: Both VM and NIC must be in West US region

NIC Must Be Unattached: The NIC must not be attached to another VM

VM State: VM can be running or stopped (but not deallocated)

After Attachment Inside VM:

The OS will see a new network interface

You need to configure IP settings inside the OS

This is NOT part of this lab - just attaching is enough

Order Matters: The first NIC is primary; additional NICs are secondary

Complete CLI Example:
bash
# 1. Login
az login -u kk_lab_user_main-1a7d044ea82a4fcd@azurefreekmlprod.onmicrosoft.com -p xT9k7Gbp

# 2. Find resource group
az group list --output table
# Output: kml_rg_main-xxxxx

# 3. Verify resources exist (replace YOUR_RG)
az vm show --resource-group YOUR_RG --name xfusion-vm --query name -o tsv
az network nic show --resource-group YOUR_RG --name xfusion-nic --query name -o tsv

# 4. Attach NIC
az vm nic add --resource-group YOUR_RG --vm-name xfusion-vm --nics xfusion-nic

# 5. Verify attachment
az vm show --resource-group YOUR_RG --name xfusion-vm --query "networkProfile.networkInterfaces[].id"

# 6. Check NIC status
az network nic show --resource-group YOUR_RG --name xfusion-nic --query provisioningState -o tsv

# 7. Check VM initialization
az vm get-instance-view --resource-group YOUR_RG --name xfusion-vm --query "instanceView.statuses[1].displayStatus" -o tsv
Expected results:

NIC xfusion-nic appears in VM's network interfaces list

NIC shows provisioningState: "Succeeded"

VM shows "VM running" status

You've successfully added a network interface to your VM! This is essential for complex networking scenarios in the cloud
